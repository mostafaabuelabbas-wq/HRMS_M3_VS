@model IEnumerable<HRMS_M3_VS.Areas.Employee.Models.EmployeeDto>

@{
    ViewData["Title"] = "Employee Directory";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Dynamic Title -->
        <h2 class="fw-bold text-white mb-0">
            <i class="fas fa-users me-2 text-primary"></i>
            @if (User.IsInRole("HRAdmin"))
            {
                <text>All Employees</text>
            }
            else
            {
                <text>Employee Directory</text>
            }
        </h2>
    </div>

    <!-- SEARCH BAR: Only visible for HR Admins (The "All Employees" Tab) -->
    @if (User.IsInRole("HRAdmin") || User.IsInRole("SystemAdmin"))
    {
        <div class="input-group mb-4 shadow-sm">
            <span class="input-group-text border-0 text-white" style="background-color: #1E293B;">
                <i class="fas fa-search text-secondary"></i>
            </span>
            <input type="text"
                   id="searchInput"
                   class="form-control border-0 text-white"
                   style="background-color: #1E293B;"
                   placeholder="Search by Name, Department, or Position..."
                   onkeyup="filterTable()">
        </div>
    }

    <!-- The Card Container for the Table -->
    <div class="card shadow-lg border border-secondary rounded-4 overflow-hidden" style="background-color: #1E293B;">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0 text-white" id="employeeTable">
                    <thead class="text-secondary text-uppercase small" style="background-color: rgba(255,255,255,0.05); border-bottom: 1px solid #334155;">
                        <tr>
                            <th class="py-3 ps-4 border-0">Full Name</th>
                            <th class="py-3 border-0">Department</th>
                            <th class="py-3 border-0">Position</th>
                            <th class="py-3 border-0">Status</th>
                            <th class="py-3 text-end pe-4 border-0">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td class="ps-4 fw-bold text-white border-0">
                                    <div class="d-flex align-items-center">
                                        <div class="rounded-circle bg-primary bg-opacity-10 text-primary d-flex justify-content-center align-items-center me-3 fw-bold" 
                                             style="width: 40px; height: 40px; font-size: 1.1em;">
                                            @item.Full_Name.Substring(0, 1)
                                        </div>
                                        @item.Full_Name
                                    </div>
                                </td>
                                <td class="text-secondary border-0">
                                    @(item.Department ?? "Not Assigned")
                                </td>
                                <td class="text-secondary border-0">
                                    @(item.Position ?? "Not Assigned")
                                </td>
                                <td class="border-0">
                                    <span class="badge rounded-pill bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
                                        @(item.Employment_Status ?? "Unknown")
                                    </span>
                                </td>
                                <td class="text-end pe-4 border-0">
                                    <!-- Link to Profile -->
                                    <a asp-area="Employee"
                                       asp-controller="Home"
                                       asp-action="Profile"
                                       asp-route-id="@item.Employee_Id"
                                       class="btn btn-sm btn-outline-primary rounded-pill px-3 shadow-sm visited-transition">
                                        View Profile
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- JAVASCRIPT: Makes the search work without reloading the page -->
<script>
    function filterTable() {
        // 1. Get the search term
        var input = document.getElementById("searchInput");
        var filter = input.value.toUpperCase();

        // 2. Get the table and rows
        var table = document.getElementById("employeeTable");
        var tr = table.getElementsByTagName("tr");

        // 3. Loop through all rows (Start at 1 to skip Header)
        for (var i = 1; i < tr.length; i++) {
            var tdName = tr[i].getElementsByTagName("td")[0]; // Full Name
            var tdDept = tr[i].getElementsByTagName("td")[1]; // Department
            var tdPos  = tr[i].getElementsByTagName("td")[2]; // Position

            if (tdName || tdDept || tdPos) {
                var txtValue = (tdName.textContent || tdName.innerText) + " " +
                               (tdDept.textContent || tdDept.innerText) + " " +
                               (tdPos.textContent  || tdPos.innerText);

                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>