@model HRMS_M3_VS.Areas.Employee.Models.EmployeeDto
@using System.Security.Claims

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "My Profile";
}

<div class="container py-4">

    <!-- Main Profile Card -->
    <div class="card border border-secondary shadow-lg rounded-4 overflow-hidden" style="min-height: 80vh; background-color: #1E293B;">

        <!-- Cover Background -->
        <div style="height: 200px; background: linear-gradient(135deg, #0F172A 0%, #334155 100%); position: relative;">
            <div class="position-absolute top-0 end-0 p-4 d-flex gap-2">
                
                <!-- LOGIC: Back Button for HR Admin (From Master) -->
                @{
                    var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
                    // Show button ONLY if HR Admin AND NOT viewing their own profile
                    if (User.IsInRole("HRAdmin") && currentUserId != null && Model.Employee_Id.ToString() != currentUserId)
                    {
                        <a asp-controller="HRAdmin" asp-action="ProfileCompleteness" class="btn btn-outline-light shadow fw-bold rounded-pill px-4 transition-btn">
                            <i class="fas fa-arrow-left me-2"></i> Back to Report
                        </a>
                    }
                }

                <!-- Edit Button -->
                <a asp-action="Edit" asp-route-id="@Model.Employee_Id" class="btn btn-light shadow fw-bold rounded-pill px-4 transition-btn">
                    <i class="fas fa-pen me-2"></i> Edit Profile
                </a>
            </div>
        </div>

        <div class="card-body px-4 px-md-5 pb-5">

            <!-- Header Section -->
            <div class="row mb-5">
                <div class="col-lg-auto text-center text-lg-start" style="margin-top: -100px;">
                    <div class="position-relative d-inline-block">
                        
                        <!-- LOGIC: Image Handling (From Master - Base64) -->
                        <!-- STYLE: Dark Borders (From Mohamad) -->
                        @if (Model.Profile_Image != null && Model.Profile_Image.Length > 0)
                        {
                            var base64 = Convert.ToBase64String(Model.Profile_Image);
                            <img src="data:image/*;base64,@base64" class="rounded-circle shadow-lg"
                                 style="width: 170px; height: 170px; object-fit: cover; border: 6px solid #1E293B; background-color: #1E293B;"
                                 onerror="this.src='https://ui-avatars.com/api/?name=@Model.Full_Name&background=random&size=170';"
                                 alt="Profile" />
                        }
                        else
                        {
                            <img src="https://ui-avatars.com/api/?name=@Model.Full_Name&background=random&size=170"
                                 class="rounded-circle shadow-lg"
                                 style="width: 170px; height: 170px; object-fit: cover; border: 6px solid #1E293B; background-color: #1E293B;"
                                 alt="Default" />
                        }
                    </div>
                </div>

                <div class="col-lg pt-3 ps-lg-4 text-center text-lg-start">
                    <h1 class="fw-bold text-white mb-1">@Model.Full_Name</h1>
                    <p class="text-secondary fs-5 mb-3">@Model.Position</p>
                    <div class="d-flex justify-content-center justify-content-lg-start gap-2">
                        <span class="badge rounded-pill bg-dark border border-secondary text-white px-3 py-2">
                            <i class="fas fa-building me-2 text-primary"></i> @Model.Department
                        </span>
                        <span class="badge rounded-pill bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-3 py-2">
                            <i class="fas fa-circle me-2 small"></i> @Model.Employment_Status
                        </span>
                    </div>
                </div>
            </div>

            <!-- Detailed Info Grid -->
            <div class="row g-4 align-items-stretch">

                <!-- Left: Personal Information -->
                <div class="col-md-7 d-flex flex-column">
                    <h5 class="text-uppercase text-primary fw-bold mb-3" style="font-size: 0.85rem; letter-spacing: 1px;">
                        <i class="fas fa-user-circle me-2"></i> Personal Information
                    </h5>

                    <div class="row g-3 flex-grow-1">
                        <div class="col-sm-6">
                            <div class="p-3 border border-secondary rounded-3 h-100" style="background-color: rgba(0,0,0,0.2);">
                                <label class="d-block text-uppercase text-muted fw-bold small mb-1" style="font-size: 0.7rem;">Email Address</label>
                                <span class="fw-bold text-white text-break">@Model.Email</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="p-3 border border-secondary rounded-3 h-100" style="background-color: rgba(0,0,0,0.2);">
                                <label class="d-block text-uppercase text-muted fw-bold small mb-1" style="font-size: 0.7rem;">Phone Number</label>
                                <span class="fw-bold text-white">@Model.Phone</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="p-3 border border-secondary rounded-3 h-100" style="background-color: rgba(0,0,0,0.2);">
                                <label class="d-block text-uppercase text-muted fw-bold small mb-1" style="font-size: 0.7rem;">Address</label>
                                <span class="fw-bold text-white">@Model.Address</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="p-3 border border-secondary rounded-3 h-100" style="background-color: rgba(0,0,0,0.2);">
                                <label class="d-block text-uppercase text-muted fw-bold small mb-1" style="font-size: 0.7rem;">Hire Date</label>
                                <span class="fw-bold text-white">@(Model.Hire_Date?.ToShortDateString() ?? "N/A")</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Emergency Contact -->
                <div class="col-md-5 d-flex flex-column">
                    <h5 class="text-uppercase text-danger fw-bold mb-3" style="font-size: 0.85rem; letter-spacing: 1px;">
                        <i class="fas fa-heartbeat me-2"></i> Emergency Contact
                    </h5>

                    <div class="card border border-danger border-opacity-25 rounded-4 h-100" style="background-color: rgba(239, 68, 68, 0.05);">
                        <div class="card-body p-4 d-flex flex-column justify-content-center">

                            <div class="mb-4">
                                <label class="d-block text-uppercase text-danger fw-bold small mb-1 opacity-75" style="font-size: 0.7rem;">Contact Name</label>
                                <span class="fw-bold text-white">@(Model.Emergency_Contact_Name ?? "Not Provided")</span>
                            </div>

                            <div class="mb-4">
                                <label class="d-block text-uppercase text-danger fw-bold small mb-1 opacity-75" style="font-size: 0.7rem;">Relationship</label>
                                <span class="fw-bold text-white">@(Model.Relationship ?? "N/A")</span>
                            </div>

                            <div>
                                <label class="d-block text-uppercase text-danger fw-bold small mb-1 opacity-75" style="font-size: 0.7rem;">Phone</label>
                                <span class="fw-bold text-white">
                                    <i class="fas fa-phone-alt me-2 text-danger"></i>@(Model.Emergency_Contact_Phone ?? "N/A")
                                </span>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>