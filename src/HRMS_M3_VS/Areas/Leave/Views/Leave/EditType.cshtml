@model HRMS_M3_VS.Areas.Leave.Models.LeaveConfigDto

@{
    ViewData["Title"] = "Configure Policy";
    Layout = "~/Views/Shared/_Layout.cshtml";
    bool isEdit = !string.IsNullOrEmpty(Model.leave_type);
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                <!-- Header -->
                <div class="card-header bg-dark text-white p-5 position-relative overflow-hidden">
                    <div class="position-absolute top-0 end-0 p-3 opacity-10">
                        <i class="fas fa-cogs fa-5x"></i>
                    </div>
                    <div class="position-relative z-1">
                        <a href="/Leave/Leave/ManageTypes" class="text-white-50 text-decoration-none small mb-2 d-inline-block">
                            <i class="fas fa-arrow-left me-1"></i> Back to List
                        </a>
                        <h2 class="fw-bold mb-1">@(isEdit ? "Edit Leave Policy" : "Create New Policy")</h2>
                        <p class="text-white-50 mb-0">Configure rules, accruals, and eligibility for this leave type.</p>
                    </div>
                </div>

                <div class="card-body p-5 bg-white">
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger shadow-sm border-0 border-start border-danger border-4 mb-4">
                            <i class="fas fa-exclamation-triangle me-2"></i> @TempData["Error"]
                        </div>
                    }

                    <form action="/Leave/Leave/SaveType" method="post" class="needs-validation" novalidate>
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="leave_id" value="@Model.leave_id" />

                        <!-- Section 1: Basic Information -->
                        <div class="mb-5">
                            <div class="d-flex align-items-center mb-4">
                                <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-2 me-3">
                                    <i class="fas fa-info-circle fa-lg"></i>
                                </div>
                                <h5 class="fw-bold m-0 text-dark">Basic Information</h5>
                            </div>

                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold text-secondary small text-uppercase ls-1">Leave Type Name</label>
                                    @if (isEdit)
                                    {
                                        <input name="leave_type" value="@Model.leave_type" class="form-control bg-light fw-bold text-dark" readonly />
                                        <div class="form-text">Cannot be changed after creation.</div>
                                    }
                                    else
                                    {
                                        <input name="leave_type" value="@Model.leave_type" class="form-control form-control-lg" placeholder="e.g. Remote Work" required />
                                        <div class="invalid-feedback">Please provide a name.</div>
                                    }
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-semibold text-secondary small text-uppercase ls-1">Description</label>
                                    <textarea name="leave_description" class="form-control" rows="3" placeholder="Describe the purpose of this leave type...">@Model.leave_description</textarea>
                                </div>
                            </div>
                        </div>

                        <hr class="my-5 border-light-subtle" />

                        <!-- Section 2: Policy & Restrictions -->
                        <div class="mb-5">
                            <div class="d-flex align-items-center mb-4">
                                <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-2 me-3">
                                    <i class="fas fa-shield-alt fa-lg"></i>
                                </div>
                                <h5 class="fw-bold m-0 text-dark">Policy Rules & Restrictions</h5>
                            </div>

                            <div class="row g-4 bg-light p-4 rounded-4 border border-light-subtle">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Notice Period (Days)</label>
                                    <div class="input-group">
                                        <input name="notice_period" value="@Model.notice_period" type="number" class="form-control" min="0" />
                                        <span class="input-group-text bg-white text-muted">days</span>
                                    </div>
                                    <div class="form-text small">Minimum days required before start date.</div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Max Duration</label>
                                    <div class="input-group">
                                        <input name="max_duration" value="@Model.max_duration" type="number" class="form-control" min="1" />
                                        <span class="input-group-text bg-white text-muted">days</span>
                                    </div>
                                    <div class="form-text small">Maximum allowed days per request.</div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Workflow</label>
                                    <select name="workflow_type" class="form-select">
                                        <!option value="Standard" @(Model.workflow_type == "Standard" ? "selected" : "")>Standard (Line Manager)</!option>
                                        <!option value="Auto-Approve" @(Model.workflow_type == "Auto-Approve" ? "selected" : "")>Auto-Approve</!option>
                                        <!option value="HR-Review" @(Model.workflow_type == "HR-Review" ? "selected" : "")>HR Review Required</!option>
                                    </select>
                                    <div class="form-text small">Approval process for this type.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Section 3: Eligibility -->
                        <div class="mb-5">
                            <div class="d-flex align-items-center mb-4">
                                <div class="bg-success bg-opacity-10 text-success rounded-circle p-2 me-3">
                                    <i class="fas fa-users fa-lg"></i>
                                </div>
                                <h5 class="fw-bold m-0 text-dark">Eligibility</h5>
                            </div>
                            
                            <div class="p-3 border rounded-3">
                                <label class="form-label fw-semibold text-secondary small text-uppercase ls-1">Eligibility Rule</label>
                                <input name="eligibility_rules" value="@Model.eligibility_rules" class="form-control" placeholder="e.g. Full-Time Only; MinTenure=6Months" />
                                <div class="d-flex gap-2 mt-2 flex-wrap">
                                    <span class="badge bg-light text-dark border cursor-pointer" onclick="setRule('All')">All</span>
                                    <span class="badge bg-light text-dark border cursor-pointer" onclick="setRule('Type=FullTime')">Type=FullTime</span>
                                    <span class="badge bg-light text-dark border cursor-pointer" onclick="setRule('Type=PartTime')">Type=PartTime</span>
                                    <span class="badge bg-light text-dark border cursor-pointer" onclick="setRule('MinTenure=180')">MinTenure=180</span>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="d-grid gap-3 pt-3">
                            <button type="submit" class="btn btn-dark btn-lg rounded-pill shadow-lg">
                                <i class="fas fa-save me-2"></i> Save Configuration
                            </button>
                            <a href="/Leave/Leave/ManageTypes" class="btn btn-link text-muted text-decoration-none">
                                Cancel and return to list
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function setRule(val) {
        document.getElementsByName('eligibility_rules')[0].value = val;
    }
</script>

<style>
    .ls-1 { letter-spacing: 1px; }
    .cursor-pointer { cursor: pointer; }
    .form-control:focus, .form-select:focus {
        border-color: #212529;
        box-shadow: 0 0 0 0.25rem rgba(33, 37, 41, 0.1);
    }
</style>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}